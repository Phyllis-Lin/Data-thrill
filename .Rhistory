count(hotel,Country,is_repeated_guest)%>%
pivot_wider(names_from="is_repeated_guest",values_from=n)%>%
rename(not_repeated_guest="0",repeated_guest="1")%>%
filter(!is.na(repeated_guest))%>%
mutate(prop=round(repeated_guest/(not_repeated_guest+repeated_guest),digits=3))%>%
arrange(desc(prop))%>%
ungroup()%>%
slice_head(n =20)
prop_c <- a%>%
filter(hotel=="City Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of City Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.02))
prop_r <- a%>%
filter(hotel=="Resort Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of Resort Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.2))
grid.arrange(prop_c,prop_r,ncol=2)
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(tidyverse)
library(countrycode)
library(lubridate)
library(naniar)
hotels <- read.csv("data/hotels.csv")
Miss_tidy <- vis_miss(hotels, warn_large_data =FALSE) #check wether have mssing value in data set
Miss_tidy
hotel <- na.omit(hotels)
hotel <- hotel %>% mutate(
arr_date_month = case_when(   # change Month to the numeric
arrival_date_month=="January" ~ 01,
arrival_date_month=="February" ~ 02,
arrival_date_month=="March" ~ 03,
arrival_date_month=="April" ~ 04,
arrival_date_month=="May" ~ 05,
arrival_date_month=="June" ~ 06,
arrival_date_month=="July" ~ 07,
arrival_date_month=="August" ~ 08,
arrival_date_month=="September" ~ 09,
arrival_date_month=="October" ~ 10,
arrival_date_month=="November" ~ 11,
arrival_date_month=="December" ~ 12),
country = str_replace(country, pattern = "cn", replacement = "chn"), # replace China pattern
deposit = case_when(deposit_type == "No Deposit"~0,            # Change deposit as binary numeric
deposit_type == "Non Refund"~1,
deposit_type == "Refundable"~2),
arrival_time=paste(arrival_date_year,
arrival_date_month,
arrival_date_day_of_month,
sep="-"))%>%
mutate(Country = countrycode(sourcevar = country,              # According the country code to find the country full name
origin = "iso3c",
destination = "country.name"),
reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))
vis_tidy <- vis_miss(tidy, warn_large_data =FALSE)
vis_tidy <- vis_miss(tidy, warn_large_data =FALSE)
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(tidyverse)
library(countrycode)
library(lubridate)
library(naniar)
hotels <- read.csv("data/hotels.csv")
Miss_tidy <- vis_miss(hotels, warn_large_data =FALSE) #check wether have mssing value in data set
Miss_tidy
hotel <- na.omit(hotels)
hotel <- hotel %>% mutate(
arr_date_month = case_when(   # change Month to the numeric
arrival_date_month=="January" ~ 01,
arrival_date_month=="February" ~ 02,
arrival_date_month=="March" ~ 03,
arrival_date_month=="April" ~ 04,
arrival_date_month=="May" ~ 05,
arrival_date_month=="June" ~ 06,
arrival_date_month=="July" ~ 07,
arrival_date_month=="August" ~ 08,
arrival_date_month=="September" ~ 09,
arrival_date_month=="October" ~ 10,
arrival_date_month=="November" ~ 11,
arrival_date_month=="December" ~ 12),
country = str_replace(country, pattern = "cn", replacement = "chn"), # replace China pattern
deposit = case_when(deposit_type == "No Deposit"~0,            # Change deposit as binary numeric
deposit_type == "Non Refund"~1,
deposit_type == "Refundable"~2),
arrival_time=paste(arrival_date_year,
arrival_date_month,
arrival_date_day_of_month,
sep="-"))%>%
mutate(Country = countrycode(sourcevar = country,              # According the country code to find the country full name
origin = "iso3c",
destination = "country.name"),
reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))
vis_tidy <- vis_miss(tidy, warn_large_data =FALSE)
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(tidyverse)
library(countrycode)
library(lubridate)
library(naniar)
hotels <- read.csv("data/hotels.csv")
Miss_tidy <- vis_miss(hotels, warn_large_data =FALSE) #check wether have mssing value in data set
Miss_tidy
hotel <- na.omit(hotels)
hotel <- hotel %>% mutate(
arr_date_month = case_when(   # change Month to the numeric
arrival_date_month=="January" ~ 01,
arrival_date_month=="February" ~ 02,
arrival_date_month=="March" ~ 03,
arrival_date_month=="April" ~ 04,
arrival_date_month=="May" ~ 05,
arrival_date_month=="June" ~ 06,
arrival_date_month=="July" ~ 07,
arrival_date_month=="August" ~ 08,
arrival_date_month=="September" ~ 09,
arrival_date_month=="October" ~ 10,
arrival_date_month=="November" ~ 11,
arrival_date_month=="December" ~ 12),
country = str_replace(country, pattern = "cn", replacement = "chn"), # replace China pattern
deposit = case_when(deposit_type == "No Deposit"~0,            # Change deposit as binary numeric
deposit_type == "Non Refund"~1,
deposit_type == "Refundable"~2),
arrival_time=paste(arrival_date_year,
arrival_date_month,
arrival_date_day_of_month,
sep="-"))%>%
mutate(Country = countrycode(sourcevar = country,              # According the country code to find the country full name
origin = "iso3c",
destination = "country.name"),
reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))
tidy <- hotel %>% dplyr::select(-market_segment,
-distribution_channel,
-deposit_type,
-agent,
-company)
final <- na.omit(tidy)  # Delete the missing country observations
library(gridExtra)
a <- final%>%
select(hotel,Country,is_repeated_guest)%>%
count(hotel,Country,is_repeated_guest)%>%
pivot_wider(names_from="is_repeated_guest",values_from=n)%>%
rename(not_repeated_guest="0",repeated_guest="1")%>%
filter(!is.na(repeated_guest))%>%
mutate(prop=round(repeated_guest/(not_repeated_guest+repeated_guest),digits=3))%>%
arrange(desc(prop))%>%
ungroup()%>%
slice_head(n =20)
prop_c <- a%>%
filter(hotel=="City Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of City Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.02))
prop_r <- a%>%
filter(hotel=="Resort Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of Resort Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.2))
grid.arrange(prop_c,prop_r,ncol=2)
library(gridExtra)
a <- final%>%
select(hotel,Country,is_repeated_guest)%>%
count(hotel,Country,is_repeated_guest)%>%
pivot_wider(names_from="is_repeated_guest",values_from=n)%>%
rename(not_repeated_guest="0",repeated_guest="1")%>%
filter(!is.na(repeated_guest))%>%
mutate(prop=round(repeated_guest/(not_repeated_guest+repeated_guest),digits=3))%>%
arrange(desc(prop))%>%
ungroup()%>%
slice_head(n =20)
prop_c <- a%>%
filter(hotel=="City Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of City Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.02))
prop_r <- a%>%
filter(hotel=="Resort Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of Resort Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.2))
grid.arrange(prop_c,prop_r,ncol=2)
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
facet_wrap(~hotel)
theme_bw()
View(Miss_tidy)
View(plot_interval)
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_histogram(binwidth=0.01)+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
facet_wrap(~hotel)
theme_bw()
?geom_bar()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar(width=100)+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar(width=20)+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar(width=0.5)+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(limits=c(0,600),breaks=c(5000,8000,11000,14000,17000))+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(limits=c(0,600),breaks=20)+
facet_wrap(~hotel)
theme_bw()
?scale_x_continuous()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,20))+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,20))+
theme(axis.title.x=element_text(angle=90))+
facet_wrap(~hotel)
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,20))+
theme(axis.text.x=element_text(angle=90))+
facet_wrap(~hotel)+
theme_bw()
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,20))+
theme(axis.text.x=element_text(angle=90))+
facet_wrap(~hotel)
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,50))+
theme(axis.text.x=element_text(angle=90))+
facet_wrap(~hotel)
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,50))+
theme(axis.text.x=element_text(angle=90))+
lab(x="interval(day)")+
facet_wrap(~hotel)
library(lubridate)
plot_interval<- final%>%
filter(is_canceled==1)%>%
select(hotel,is_canceled,reservation_status,reservation_status_date,arrival_time)%>%
filter(reservation_status=="Canceled")%>%
mutate(reservation_status_date=ymd(reservation_status_date),
arrival_time=ymd(arrival_time))%>%
mutate(interval=arrival_time-reservation_status_date)
plot_interval%>%
ggplot(aes(x=interval))+
geom_bar()+
scale_x_continuous(breaks=seq(0,600,50))+
theme(axis.text.x=element_text(angle=90))+
labs(x="interval(day)")+
facet_wrap(~hotel)
interval_c <- plot_interval%>%
filter(hotel=="City Hotel")%>%
ggplot(aes(x = interval,
y = ..density..)) +
geom_density(fill = "white") +
geom_vline(xintercept = mean(plot_interval$interval),
colour = "red")+
labs(x="interval(day)")
interval_r <- plot_interval%>%
filter(hotel=="Resort Hotel")%>%
ggplot(aes(x = interval,
y = ..density..)) +
geom_density(fill = "white") +
geom_vline(xintercept = mean(plot_interval$interval),
colour = "red")+
labs(x="interval(day)")
grid.arrange(interval_c,interval_r,ncol=2)
library(gridExtra)
a <- final%>%
select(hotel,Country,is_repeated_guest)%>%
count(hotel,Country,is_repeated_guest)%>%
pivot_wider(names_from="is_repeated_guest",values_from=n)%>%
rename(not_repeated_guest="0",repeated_guest="1")%>%
filter(!is.na(repeated_guest))%>%
mutate(prop=round(repeated_guest/(not_repeated_guest+repeated_guest),digits=3))%>%
arrange(desc(prop))%>%
ungroup()%>%
slice_head(n =20)
prop_c <- a%>%
filter(hotel=="City Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of City Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.02))
prop_r <- a%>%
filter(hotel=="Resort Hotel")%>%
ggplot(aes(x=reorder(Country,prop),y=prop))+
geom_col(show.legend = FALSE)+
coord_flip()+
theme_minimal()+
labs(title = "Repeated guest proportion of Resort Hotel from July 2015 to August 2017",
x = "",
y="proportion")+
theme(plot.title=element_text(size=7))+
geom_text(aes(label=prop),hjust = -0.008, size = 2)+
scale_y_continuous(breaks=seq(0,1,0.2))
grid.arrange(prop_c,prop_r,ncol=2)
shiny::runApp('app')
runApp('app')
runApp('app')
devtools::install_github("etc5523-2020/r-package-assessment-petestylianos")
runApp('app')
runApp('app')
